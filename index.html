<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PIO üåô Lunar $POP Dashboard</title>
<style>
body { margin:0; font-family:Arial,sans-serif; background:radial-gradient(circle at top,#0b0b1a,#000); color:#e6ffe6; }
header { padding:20px; text-align:center; }
h1 { margin-bottom:5px; }
.contract { font-size:12px; opacity:0.8; word-break:break-all; }
.container { max-width:1200px; margin:auto; padding:20px; display:grid; grid-template-columns:1fr 1fr; gap:25px; }
#pio-zone { margin:20px auto; text-align:center; }
#pio-face { width:180px; transition: transform 0.4s ease; }
#pio-mood { margin-top:10px; font-size:18px; opacity:0.9; }
.pio-happy { transform: scale(1.05); }
.pio-laugh { transform: scale(1.15) rotate(2deg); }
.pio-sing { animation: pioBounce 0.6s infinite; }
@keyframes pioBounce { 0%{transform:translateY(0);}50%{transform:translateY(-12px);}100%{transform:translateY(0);} }
.panel { background: rgba(0,0,0,0.6); padding: 20px; border-radius: 18px; box-shadow: 0 0 30px #00ff88, 0 0 60px #00ff88 inset; border: 2px solid #00ff88; }
.health-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
.health-card, .lunar-card { background: rgba(0,255,136,0.05); border-radius: 14px; padding: 15px; text-align: center; border: 1px solid #00ff88; box-shadow: 0 0 15px #00ff88 inset; }
.health-title, .lunar-title { font-size: 13px; opacity: 0.7; margin-bottom: 6px; }
.health-value, .lunar-value { font-size: 18px; font-weight: bold; }
.health-good { color: #8cffc1; }
.health-mid { color: #a0ffb8; }
.health-bad { color: #ff6a6a; }
.buttons { margin: 20px 0; text-align: center; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
button { background: linear-gradient(135deg, #00ff88, #00cc66); border: none; color: #000; padding: 14px 22px; margin: 10px; border-radius: 30px; font-size: 16px; cursor: pointer; box-shadow: 0 0 20px #00ff88; font-weight: bold; }
button:hover { transform: scale(1.05); box-shadow: 0 0 30px #00ff88; }
.neon-outline { background:transparent; color:#00ff88; border:2px solid #00ff88; box-shadow:0 0 15px #00ff88, inset 0 0 15px #00ff88; }
.neon-outline:hover { background:rgba(0,255,136,0.1); }
#walletBox { display:none; margin-top:15px; padding:15px; border-radius:14px; border:1px solid #00ff88; box-shadow: inset 0 0 15px #00ff88; background: rgba(0,255,136,0.05); }
#moonOutput { margin-top: 15px; font-size: 18px; min-height: 40px; text-align: center; }
#lunar-panel { display: flex; flex-direction: column; gap: 15px; }
canvas { display: block; margin: auto; background: rgba(0,255,136,0.02); border-radius: 10px; }
footer { opacity: 0.5; font-size: 12px; margin: 20px; text-align: center; }
</style>
</head>
<body>

<header>
  <h1>PIO üåô $POP Lunar Dashboard</h1>
  <div class="contract">
    $POP Contract (Solana):<br>
    7GCihgDB8fe6KNjn2MYtkzZcRjQy3t9GHdC8uHYmW2hr
  </div>
</header>

<div class="container">

  <!-- LEFT COLUMN -->
  <div>
    <div id="pio-zone">
      <img id="pio-face" src="pio-images/pio-neutral.png" />
      <div id="pio-mood">PIO is calm üåô</div>
    </div>

    <div class="panel" id="pio-chart-panel">
      <h3 style="text-align:center;">üìä $POP Live Data</h3>
      <div id="tsukiPrice" style="font-size:24px; margin:10px 0; color:#00ff88;">Loading data‚Ä¶</div>
      <canvas id="tsukiCandleChart" width="500" height="200"></canvas>
    </div>

    <div class="panel" id="pio-health">
      <div class="health-grid">
        <div class="health-card">
          <div class="health-title">ü©∫ PIO Health</div>
          <div id="pioHealth" class="health-value health-mid">Stable</div>
        </div>
        <div class="health-card">
          <div class="health-title">üèü PIO Arena</div>
          <div id="pioArena" class="health-value">Neutral Zone üåó</div>
        </div>
        <div class="health-card">
          <div class="health-title">üå± Environment</div>
          <div id="pioEnv" class="health-value health-mid">Uncertain</div>
        </div>
        <div class="health-card">
          <div class="health-title">üß¨ PIO Age</div>
          <div id="pioAge" class="health-value">Loading‚Ä¶</div>
        </div>
      </div>
    </div>

    <div class="buttons">
      <button onclick="rewardPIO()">üåô Reward PIO</button>
      <!-- üîπ NEW BUTTON -->
      <button class="neon-outline" onclick="connectWallet()">Watch PIO Grow</button>
    </div>

    <div id="moonOutput">üåô Awaiting lunar action...</div>
  </div>

  <!-- RIGHT COLUMN: Lunar Consultation -->
  <div class="panel" id="lunar-panel">
    <div class="lunar-card">
      <div class="lunar-title">üåï Lunar Matrix</div>
      <div id="lunarMatrix" class="lunar-value">Loading...</div>
    </div>
    <div class="lunar-card">
      <div class="lunar-title">üìÖ Lunar Calendar Numbers</div>
      <div id="lunarNumbers" class="lunar-value">Loading...</div>
    </div>
    <div class="lunar-card">
      <div class="lunar-title">‚ôà Lunar Signs</div>
      <div id="lunarSigns" class="lunar-value">Loading...</div>
    </div>
    <canvas id="lunarCircle" width="250" height="250"></canvas>

    <!-- üîπ NEW WALLET BOX -->
    <div id="walletBox">
      <div><strong>Address:</strong></div>
      <div id="walletAddress"></div>
      <br>
      <div><strong>SOL Balance:</strong></div>
      <div id="walletSol"></div>
    </div>
  </div>

</div>

<footer>
  $POP Lunar Dashboard ‚Ä¢ Live on Solana ‚Ä¢ Trust-based üåô
</footer>

<script>
const POP_ADDRESS = "7GCihgDB8fe6KNjn2MYtkzZcRjQy3t9GHdC8uHYmW2hr";
let candles = [];

// ---- Dexscreener Price + Candles ----
async function fetchDexData() {
  try {
    const res = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${POP_ADDRESS}`);
    const data = await res.json();
    const price = parseFloat(data.pairs[0].priceUsd);
    document.getElementById("tsukiPrice").innerText = `$POP Price: $${price.toFixed(6)}`;

    if(candles.length === 0){
      let lastPrice = price;
      for(let i=0;i<10;i++){
        let open = lastPrice;
        let close = open + (Math.random()-0.5)*0.005;
        let high = Math.max(open, close) + Math.random()*0.002;
        let low = Math.min(open, close) - Math.random()*0.002;
        candles.push({open, high, low, close});
        lastPrice = close;
      }
    } else {
      candles.shift();
      let open = candles[candles.length-1].close;
      let close = open + (Math.random()-0.5)*0.005;
      let high = Math.max(open, close) + Math.random()*0.002;
      let low = Math.min(open, close) - Math.random()*0.002;
      candles.push({open, high, low, close});
    }

    drawCandles();
    updatePIOEmotion(candles[candles.length-1]);
  } catch(err){
    console.error(err);
    document.getElementById("tsukiPrice").innerText = "‚ö†Ô∏è Error fetching price";
  }
}

// Candlestick chart drawing
function drawCandles(){
  const canvas = document.getElementById("tsukiCandleChart");
  const ctx = canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(candles.length === 0) return;

  const padding = 20;
  const chartHeight = canvas.height - padding*2;
  const chartWidth = canvas.width - padding*2;
  const candleWidth = chartWidth / candles.length - 5;
  const maxPrice = Math.max(...candles.map(c=>c.high));
  const minPrice = Math.min(...candles.map(c=>c.low));
  const scale = chartHeight / (maxPrice - minPrice);

  candles.forEach((c,i)=>{
    const x = padding + i*(candleWidth+5);
    const yOpen = padding + (maxPrice - c.open)*scale;
    const yClose = padding + (maxPrice - c.close)*scale;
    const yHigh = padding + (maxPrice - c.high)*scale;
    const yLow = padding + (maxPrice - c.low)*scale;

    ctx.strokeStyle = "#00ff88";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x + candleWidth/2, yHigh);
    ctx.lineTo(x + candleWidth/2, yLow);
    ctx.stroke();

    ctx.fillStyle = c.close >= c.open ? "#00ff88" : "#ff6a6a";
    ctx.fillRect(x, Math.min(yOpen,yClose), candleWidth, Math.abs(yClose - yOpen));
  });
}

// PIO emotion
function updatePIOEmotion(candle){
  const face = document.getElementById("pio-face");
  const mood = document.getElementById("pio-mood");
  face.className = "";
  const change = candle.close - candle.open;

  if(change < -0.002){ face.src="pio-images/pio-sad.png"; mood.innerText="PIO feels sad üòø"; }
  else if(change < 0){ face.src="pio-images/pio-worried.png"; mood.innerText="PIO is worried üòü"; }
  else if(change < 0.002){ face.src="pio-images/pio-neutral.png"; mood.innerText="PIO is indifferent üòê"; }
  else if(change < 0.004){ face.src="pio-images/pio-happy.png"; face.classList.add("pio-happy"); mood.innerText="PIO is happy üò∫"; }
  else{ face.src="pio-images/pio-sing.png"; face.classList.add("pio-sing"); mood.innerText="PIO ENTERED PARTY MODE üé§üî•"; }
}

// Lunar / PIO panels
const LAUNCH_DATE = new Date("2024-05-11T00:00:00Z");
function updateAge() {
  const days = Math.floor((new Date() - LAUNCH_DATE) / 86400000);
  const months = Math.floor(days / 30.44);
  document.getElementById("pioAge").innerText = `${months} months (${days} days)`;
}
function rewardPIO() {
  const output = document.getElementById("moonOutput");
  output.innerHTML = "üåï Sending lunar signal...";
  setTimeout(()=>{ output.innerHTML = "PIO received üåô Lunar Treats!"; }, 1500);
}
function updateHealth(change){
  const h=document.getElementById("pioHealth");
  const a=document.getElementById("pioArena");
  const e=document.getElementById("pioEnv");
  h.className="health-value"; e.className="health-value";
  if(change>3){ h.innerText="Thriving üöÄ"; h.classList.add("health-good"); a.innerText="Moon Arena üåï"; e.innerText="Bullish"; e.classList.add("health-good"); }
  else if(change>0.5){ h.innerText="Healthy üò∫"; h.classList.add("health-good"); a.innerText="Memecoin Season üåà"; e.innerText="Optimistic"; e.classList.add("health-mid"); }
  else if(change>-1){ h.innerText="Stable üåô"; h.classList.add("health-mid"); a.innerText="Neutral Zone üåó"; e.innerText="Uncertain"; e.classList.add("health-mid"); }
  else{ h.innerText="Under Stress üòø"; h.classList.add("health-bad"); a.innerText="Shadow Arena üåë"; e.innerText="Bearish"; e.classList.add("health-bad"); }
}
function updateLunarPanel() {
  const matrix = Math.floor(Math.random()*99 + 1);
  const numbers = Array.from({length:6}, () => Math.floor(Math.random()*30+1));
  const signs = ["üåë New Moon","üåì First Quarter","üåï Full Moon","üåó Last Quarter"];
  const currentSign = signs[Math.floor(Math.random()*signs.length)];
  document.getElementById("lunarMatrix").innerText = matrix;
  document.getElementById("lunarNumbers").innerText = numbers.join(" - ");
  document.getElementById("lunarSigns").innerText = currentSign;
}
async function updateDashboard() {
  await fetchDexData();
  const change = (Math.random()-0.45)*8;
  updateHealth(change);
  updateLunarPanel();
}
updateAge();
updateDashboard();
setInterval(updateDashboard, 60000);

// ---- PHANTOM WALLET ----
async function connectWallet() {
  if (!window.solana || !window.solana.isPhantom) { alert("Phantom Wallet not found"); return; }
  try {
    const resp = await window.solana.connect();
    const address = resp.publicKey.toString();
    document.getElementById("walletAddress").innerText = address;
    document.getElementById("walletBox").style.display="block";
    document.getElementById("moonOutput").innerText="üåô Wallet connected!";
    fetchSolBalance(address);
  } catch(err){ console.error(err); }
}
async function fetchSolBalance(address){
  const res = await fetch("https://api.mainnet-beta.solana.com", {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({ jsonrpc:"2.0", id:1, method:"getBalance", params:[address] })
  });
  const data = await res.json();
  const sol = data.result.value/1e9;
  document.getElementById("walletSol").innerText=sol.toFixed(4)+" SOL";
}
</script>

</body>
</html>
